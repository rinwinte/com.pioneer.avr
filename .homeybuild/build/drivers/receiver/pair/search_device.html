<link href="../../../assets/pairing.css" rel="stylesheet">

<div class="container-2">
    <p data-i18n="pair.search_device.intro"></p>
    <p data-i18n="pair.search_device.warning"></p>

    <table class="pairSettings">
        <tr>
            <th data-i18n="pair.search_device.pSettings">Pioneer settings</th>
        </tr>
        <tr>
            <td><input id="friendlyName" type="text" value="Pioneer VSX" placeholder="Pioneer VSX"/></td>
        </tr>
        <tr>
            <td><input id="ipAddress" type="text" value="192.168.1.10" placeholder=""/></td>
        </tr>
        <tr>
            <td><input id="ipPort" type="text" value="8102" placeholder=""/></td>
        </tr>
        <tr>
            <td class="info" data-i18n="pair.search_device.ipAddressDescription"></td>
        </tr>
    </table>
</div>

<a class="btn btn-default btn-block btn-lg" id="searchButton" data-i18n="pair.search_device.search_again"
   onclick="searchAgain()">Search again</a>
<a class="btn btn-success btn-block btn-lg" id="saveButton" data-i18n="pair.search_device.manual_search"
   onclick="submit()">Manual search</a>

<script type="application/javascript">
    var saveButton = document.getElementById('saveButton');
    var friendlyNameElement = document.getElementById('friendlyName');
    var ipAddressElement = document.getElementById('ipAddress');
    var ipPortElement = document.getElementById('ipPort');

    var loading = true;

    Homey.setTitle(__('pair.search_device.title'));

    Homey.on('continue', async success => {
        console.log('search_device - continue')
        loading = false;
        return Homey.showView('list_devices');
    });

    function searchAgain() {
        Homey.showView('list_devices');
    };

    function submit() {
        if (loading) {
            console.log('Loading ..')
        }
        saveButton.classList.add('loading-fade-out');
        loading = true;

        console.log('Saving settings...');

        const friendlyName = friendlyNameElement.value;
        const ipAddress = ipAddressElement.value;
        const ipPort = ipPortElement.value;

        // If required values are filled in
        if (ipAddress !== '') {
            // Build data array
            let data = {
                friendlyName: friendlyName,
                ipAddress: ipAddress,
                port: ipPort,
                validate: true
            };

            console.log('Saving device data', data);

            // Continue to back-end, pass along data
            Homey.emit('validate_data', data);
        } else {
            saveButton.classList.remove('loading-fade-out');
            loading = false;
        }
    };

</script>